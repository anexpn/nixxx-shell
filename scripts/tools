#!/usr/bin/env ruby
# ABOUTME: Simple script to display tools installed by this Nix flake
# ABOUTME: Shows categorized list of all available development tools

# Tool definitions with descriptions
TOOLS = {
  "Core Tools" => {
    "eza" => "Modern ls replacement with colors and icons",
    "fd" => "Fast file finder, better than find",
    "ripgrep" => "Ultra-fast grep replacement (command: rg)",
    "sd" => "Intuitive find & replace, better than sed",
    "choose" => "Human-friendly cut replacement",
    "jq" => "JSON processor and query tool",
    "duf" => "Disk usage analyzer, better than df",
    "du-dust" => "Directory size analyzer, better than du (command: dust)",
    "procs" => "Modern process viewer, better than ps",
    "zoxide" => "Smarter cd that learns your habits (command: z)",
    "curl" => "Command-line HTTP client",
    "trash-cli" => "Safe file deletion to trash (command: trash)",
    "ouch" => "Universal archive compress/decompress tool",
    "ruby" => "Ruby interpreter for scripting",
    "fzf" => "Command-line fuzzy finder (default)",
    "skim" => "Alternative fuzzy finder (command: sk)",
    "yazi" => "Terminal file manager with preview (default)",
    "broot" => "Alternative interactive directory navigator (command: br)",
    "bat" => "Cat with syntax highlighting and Git integration (default)"
  },

  "Development Tools" => {
    "git" => "Version control with delta diff viewer",
    "gh" => "GitHub CLI for repo management",
    "gitleaks" => "Git secrets and credential detection",
    "shellcheck" => "Static analysis for shell scripts",
    "just" => "Command runner, better than make",
    "glow" => "Markdown viewer for terminal",
    "tealdeer" => "Fast tldr client (command: tldr)",
    "pandoc" => "Universal document converter",
    "lemmeknow" => "Identify mysterious data formats",
    "grex" => "Generate regex patterns from examples",
    "aichat" => "AI chat interface in terminal",
    "hyperfine" => "Command-line benchmarking tool",
    "direnv" => "Auto-load environment variables by directory",
    "tokei" => "Count lines of code by language (default)",
    "scc" => "Alternative fast code counter",
    "helix" => "Modal text editor with LSP support (command: hx, default)",
    "lazygit" => "Terminal UI for Git commands (default)",
    "tig" => "Alternative text-mode Git interface"
  },

  "Monitoring Tools" => {
    "btop" => "Resource monitor with interactive interface",
    "bandwhich" => "Network bandwidth monitor by process",
    "gping" => "Visual ping with graph output",
    "httpie" => "User-friendly HTTP client (command: http)",
    "lnav" => "Log file navigator and analyzer"
  },

  "Database Tools" => {
    "sqlite" => "Command-line SQLite database tool",
    "dsq" => "SQL queries on JSON/CSV/any format",
    "xsv" => "CSV manipulation toolkit"
  },

  "Container Tools" => {
    "dive" => "Docker image analysis and optimization",
    "ctop" => "Container resource monitor",
    "podman" => "Daemonless container engine",
    "k9s" => "Kubernetes TUI (Linux only)"
  },

  "Terminal Tools" => {
    "tmux" => "Terminal multiplexer with session management",
    "zellij" => "Modern terminal workspace with tabs and panes",
    "starship" => "Cross-shell prompt with Git info",
    "mcfly" => "Smart command history search (Ctrl+R)",
    "kitty" => "GPU-accelerated terminal emulator"
  }
}

# Map package names to their actual command names
COMMAND_MAP = {
  "ripgrep" => "rg",
  "du-dust" => "dust",
  "trash-cli" => "trash",
  "skim" => "sk",
  "broot" => "br",
  "tealdeer" => "tldr",
  "helix" => "hx",
  "httpie" => "http"
}

# Color codes
CYAN = "\e[36m"
GREEN = "\e[32m"
YELLOW = "\e[33m"
BLUE = "\e[34m"
GRAY = "\e[90m"
RESET = "\e[0m"

def command_exists?(package_name)
  # Map package name to actual command name
  cmd = COMMAND_MAP[package_name] || package_name
  system("command -v #{cmd} > /dev/null 2>&1")
end

def print_header(text)
  puts
  puts "#{CYAN}#{text}#{RESET}"
  puts "#{CYAN}#{'â”€' * text.length}#{RESET}"
end

def print_tool(name, description, installed)
  if installed
    puts "  #{GREEN}âœ“#{RESET} #{name.ljust(20)} #{description}"
  else
    puts "  #{GRAY}â—‹ #{name.ljust(20)} #{description}#{RESET}"
  end
end

# Parse command line arguments
show_all = ARGV.include?("--all") || ARGV.include?("-a")

# Main output
puts
puts "#{BLUE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—#{RESET}"
puts "#{BLUE}â•‘          NIXXX-SHELL INSTALLED TOOLS                      â•‘#{RESET}"
puts "#{BLUE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•#{RESET}"

TOOLS.each do |category, tools|
  installed_tools = tools.select { |name, _| command_exists?(name) }
  available_tools = tools.reject { |name, _| command_exists?(name) }

  # Skip category if no installed tools and not showing all
  next if installed_tools.empty? && !show_all

  print_header(category)

  # Show installed tools
  installed_tools.each do |name, description|
    print_tool(name, description, true)
  end

  # Show available tools if --all flag is used
  if show_all && !available_tools.empty?
    puts if !installed_tools.empty?
    puts "  #{GRAY}Available (not installed):#{RESET}"
    available_tools.each do |name, description|
      print_tool(name, description, false)
    end
  end
end

puts
puts "#{BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•#{RESET}"
puts "#{YELLOW}ğŸ’¡ Usage:#{RESET}"
puts "  â€¢ #{CYAN}tools#{RESET}          Show installed tools"
puts "  â€¢ #{CYAN}tools --all#{RESET}    Show all tools (installed and available)"
puts
puts "#{YELLOW}ğŸ’¡ Configuration:#{RESET}"
puts "  â€¢ Enable categories: #{CYAN}shell.tools.<category>.enable = true#{RESET}"
puts "  â€¢ Set alternatives: #{CYAN}shell.tools.core.fuzzy-finder = \"skim\"#{RESET}"
puts "  â€¢ Use scenarios: #{CYAN}shell.scenarios.daily-driver.enable = true#{RESET}"
puts "#{BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•#{RESET}"
